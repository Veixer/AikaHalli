@page "/Ajanseuranta"
@model AikaHalli.Pages.TimeTrackerModel
@{
	ViewData["Title"] = "Ajanseuranta";
}

<div class="container">
	<div class="row">
		<h1>Ajanseuranta</h1>
		<p>Täällä pääset suorittamaan ajanseurannan toimenpiteitä, kuten tehtävien aloitusta ja lopetusta.</p>
	</div>
	<div class="row">
		<div class="col-4">
			<table class="table table-striped table-sm">
				<thead>
					<tr>
						<th>Tehtävän Id</th>
						<th>Tehtävän Nimi</th>
						<th>Tehtävän Kuvaus</th>
					</tr>
				</thead>
				<tbody>
					@if (Model.TaskList is not null)
					{
						foreach (var task in Model.TaskList)
						{
							<tr>
								<td>@task.TaskId</td>
								<td>@task.TaskName</td>
								<td>@task.TaskDescription</td>
							</tr>
						}
					}
				</tbody>
			</table>			
		</div>
		<div class="col-2">
			<form id="timeEntryMgmt" asp-page="TimeTracker" method="post">
				@if (Model.CurrentItem is null)
				{
					// Luo uusi
					@if (Model.TaskList is not null)
					{
						<div class="row">
							<label asp-for="NewItem.TaskId">Tehtävän Id</label>
							<select asp-for="NewItem.TaskId" asp-items="@Model.TaskIdList.Select(x => new SelectListItem{Text = x.ToString()})"></select>
						</div>
						<div class="row">
							<label asp-for="NewItem.Notes"></label>
							<input asp-for="NewItem.Notes" type="text" value="" class="form-control" name="NewItem.Notes" />
						</div>
						
					}
					<button type="submit" asp-page-handler="AddNewTimeEntry" class="btn btn-primary mt-2"><i class="bi-play-circle"></i></button>
				}
				else
				{
					<div class="row">
						<label asp-for="CurrentItem.TaskId">Tehtävän Id</label>
						<input asp-for="CurrentItem.TaskId" type="text" value="@Model.CurrentItem.TaskId" class="form-control" name="Items[@Model.CurrentItem.TaskId].TaskId" disabled/>
					</div>
					<div class="row">
						<label asp-for="CurrentItem.Notes"></label>
						<input asp-for="CurrentItem.Notes" type="text" value="@Model.CurrentItem.Notes" class="form-control" name="Items[@Model.CurrentItem.TaskId].TaskId" disabled />
					</div>
					
					
					<button type="submit" asp-page-handler="StopCurrentTimeEntry" class="btn btn-danger mt-2"><i class="bi-stop-btn"></i></button>
				}
			</form>
		</div>
		<div class="col-6">
			<h3>Aikaleimat tänään</h3>
			<table class="table table-striped table-sm">
				<thead>
					<tr>
						<th>Aikaleiman Id</th>
						<th>Tehtävän Id/(Nimi)</th>
						<th>Aikaleiman alkamisaika</th>
						<th>Aikaleiman loppumisaika</th>
						<th>Aikaleiman lisätiedot</th>
					</tr>
				</thead>
				<tbody>
					@if (Model.Items is not null)
					{
						foreach (var timeEntry in Model.Items)
						{
							<tr>
								<td>@timeEntry.EntryId</td>
								<td>@timeEntry.TaskId</td>
								<td>@timeEntry.StartTime</td>
								<td>@timeEntry.EndTime</td>
								<td>@timeEntry.Notes</td>
							</tr>
						}
					}
				</tbody>
			</table>		
		</div>
	</div>
</div>